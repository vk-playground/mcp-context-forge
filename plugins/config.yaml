# plugins/config.yaml - Main plugin configuration file

plugins:
  # Argument Normalizer - stabilize inputs before anything else
  - name: "ArgumentNormalizer"
    kind: "plugins.argument_normalizer.argument_normalizer.ArgumentNormalizerPlugin"
    description: "Normalizes Unicode, whitespace, casing, dates, and numbers in args"
    version: "0.1.0"
    author: "Mihai Criveti"
    hooks: ["prompt_pre_fetch", "tool_pre_invoke"]
    tags: ["normalize", "inputs", "whitespace", "unicode", "dates", "numbers"]
    mode: "permissive"
    priority: 40
    conditions: []
    config:
      # Unicode
      enable_unicode: true
      unicode_form: "NFC"
      remove_control_chars: true

      # Whitespace
      enable_whitespace: true
      trim: true
      collapse_internal: true
      normalize_newlines: true
      collapse_blank_lines: false

      # Casing
      enable_casing: false
      case_strategy: "none"  # none|lower|upper|title

      # Dates
      enable_dates: true
      day_first: false
      year_first: false

      # Numbers
      enable_numbers: true
      decimal_detection: "auto"  # auto|comma|dot

      # Field overrides: customize per key pattern
      field_overrides: []

  # Vault Plugin - Generates bearer tokens from vault-saved tokens
  - name: "VaultPlugin"
    kind: "plugins.vault.vault_plugin.Vault"
    description: "Generates bearer tokens based on vault-saved tokens"
    version: "0.0.1"
    author: "Adrian Popa"
    hooks: ["tool_pre_invoke"]
    tags: ["security", "vault", "OAUTH2"]
    mode: "permissive"
    priority: 10
    conditions:
      - prompts: []
        server_ids: []
        tenant_ids: []
    config:
      system_tag_prefix: "system"
      vault_header_name: "X-Vault-Tokens"
      vault_handling: "raw"
      system_handling: "tag"

  # PII Filter Plugin - Run first with highest priority for security
  - name: "PIIFilterPlugin"
    kind: "plugins.pii_filter.pii_filter.PIIFilterPlugin"
    description: "Detects and masks Personally Identifiable Information"
    version: "0.1.0"
    author: "Mihai Criveti"
    hooks: ["prompt_pre_fetch", "prompt_post_fetch", "tool_pre_invoke", "tool_post_invoke"]
    tags: ["security", "pii", "compliance", "filter", "gdpr", "hipaa"]
    mode: "permissive"  # enforce | permissive | disabled
    priority: 50  # Lower number = higher priority (runs first)
    conditions:
      - prompts: []  # Empty list = apply to all prompts
        server_ids: []  # Apply to all servers
        tenant_ids: []  # Apply to all tenants
    config:
      # PII Detection Settings
      detect_ssn: true
      detect_credit_card: true
      detect_email: true
      detect_phone: true
      detect_ip_address: false  # Disabled for development
      detect_aws_keys: true
      detect_api_keys: true
      # Masking Settings
      default_mask_strategy: "partial"  # redact | partial | hash | tokenize | remove
      redaction_text: "[PII_REDACTED]"
      # Behavior Settings
      block_on_detection: false  # Set to true for strict compliance
      log_detections: true
      include_detection_details: true
      # Whitelist common test values
      whitelist_patterns:
        - "test@example.com"
        - "555-555-5555"
  # Self-contained Search Replace Plugin
  - name: "ReplaceBadWordsPlugin"
    kind: "plugins.regex_filter.search_replace.SearchReplacePlugin"
    description: "A plugin for finding and replacing words."
    version: "0.1.0"
    author: "MCP Context Forge Team"
    hooks: ["prompt_pre_fetch", "prompt_post_fetch", "tool_pre_invoke", "tool_post_invoke"]
    tags: ["plugin", "transformer", "regex", "search-and-replace", "pre-post"]
    mode: "enforce"  # enforce | permissive | disabled
    priority: 150
    conditions:
      # Apply to specific tools/servers
      - prompts: ["test_prompt"]
        server_ids: []  # Apply to all servers
        tenant_ids: []  # Apply to all tenants
    config:
      words:
        - search: crap
          replace: crud
        - search: crud
          replace: yikes
  - name: "DenyListPlugin"
    kind: "plugins.deny_filter.deny.DenyListPlugin"
    description: "A plugin that implements a deny list filter."
    version: "0.1.0"
    author: "MCP Context Forge Team"
    hooks: ["prompt_pre_fetch"]
    tags: ["plugin", "filter", "denylist", "pre-post"]
    mode: "enforce"  # enforce | permissive | disabled
    priority: 100
    conditions:
      # Apply to specific tools/servers
      - prompts: ["test_prompt"]
        server_ids: []  # Apply to all servers
        tenant_ids: []  # Apply to all tenants
    config:
      words:
        - innovative
        - groundbreaking
        - revolutionary

  # Resource Filter Plugin - Example of resource hooks
  - name: "ResourceFilterExample"
    kind: "plugins.resource_filter.resource_filter.ResourceFilterPlugin"
    description: "Demonstrates resource pre/post fetch hooks for filtering and validation"
    version: "1.0.0"
    author: "MCP Gateway Team"
    hooks: ["resource_pre_fetch", "resource_post_fetch"]
    tags: ["resource", "filter", "security", "example"]
    mode: "enforce"  # Block resources that violate rules
    priority: 75
    conditions: []  # Apply to all resources
    config:
      # Maximum content size in bytes (1MB)
      max_content_size: 1048576
      # Allowed protocols (removing file for testing)
      allowed_protocols:
        - test
        - time
        - timezone
        - http
        - https
      # Blocked domains (examples)
      blocked_domains:
        - malicious.example.com
        - untrusted-site.net
      # Content filters to redact sensitive data
      content_filters:
        - pattern: "password\\s*[:=]\\s*\\S+"
          replacement: "password: [REDACTED]"
        - pattern: "api[_-]?key\\s*[:=]\\s*\\S+"
          replacement: "api_key: [REDACTED]"
        - pattern: "secret\\s*[:=]\\s*\\S+"
          replacement: "secret: [REDACTED]"

  # - name: "OPAPluginFilter"
  #   kind: "external"
  #   mode: "permissive"  # Don't fail if the server is unavailable
  #   priority: 10 # adjust the priority
  #   mcp:
  #     proto: STREAMABLEHTTP
  #     url: http://127.0.0.1:8000/mcp

# Plugin directories to scan
plugin_dirs:
  - "plugins/native"      # Built-in plugins
  - "plugins/custom"      # Custom organization plugins
  - "/etc/mcpgateway/plugins"  # System-wide plugins

# Global plugin settings
plugin_settings:
  parallel_execution_within_band: true
  plugin_timeout: 120
  fail_on_plugin_error: false
  enable_plugin_api: true
  plugin_health_check_interval: 60
